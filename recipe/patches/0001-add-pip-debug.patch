From d30b46ac5cb9addfea66a29b0f0a401f48311d24 Mon Sep 17 00:00:00 2001
From: Olivier Roussel <olivier.roussel@inria.fr>
Date: Fri, 19 Dec 2025 17:29:39 +0100
Subject: [PATCH] add pip debug

---
 modules/python/CMakeLists.txt          |  3 +++
 modules/python/bindings/CMakeLists.txt |  3 +++
 modules/python/doc/CMakeLists.txt      |  3 +++
 modules/python/stubs/CMakeLists.txt    | 14 +++++++++++++-
 4 files changed, 22 insertions(+), 1 deletion(-)

diff --git a/modules/python/CMakeLists.txt b/modules/python/CMakeLists.txt
index fc92632e4..88f2a67d2 100644
--- a/modules/python/CMakeLists.txt
+++ b/modules/python/CMakeLists.txt
@@ -89,8 +89,11 @@ if(DOXYGEN_FOUND)
   list(APPEND bindings_dependencies visp_doc_xml)
 endif()
 
+message("========== Installing visp_python_bindgen ==========")
 add_custom_command(
   OUTPUT ${python_bindings_cpp_src}
+  COMMAND which ${PYTHON3_EXECUTABLE}
+  COMMAND ${PYTHON3_EXECUTABLE} -m pip list
   COMMAND ${PYTHON3_EXECUTABLE} -m pip install  ${_pip_args} ${bindgen_package_location}
   COMMAND ${PYTHON3_EXECUTABLE} -m visp_python_bindgen.generator --config "${CMAKE_CURRENT_SOURCE_DIR}/config" --build-folder ${bindings_gen_location} --main-config "${json_config_file_path}"
   COMMAND ${PYTHON3_EXECUTABLE} -m pip uninstall -y visp_python_bindgen
diff --git a/modules/python/bindings/CMakeLists.txt b/modules/python/bindings/CMakeLists.txt
index 86739f253..3602dcbcb 100644
--- a/modules/python/bindings/CMakeLists.txt
+++ b/modules/python/bindings/CMakeLists.txt
@@ -93,9 +93,12 @@ add_dependencies(_visp visp_python_bindings_generator_run)
 
 # Setup pip install
 if(PYTHON3INTERP_FOUND)
+  message("========== Installing visp_python_bindings ==========")
   configure_file("${CMAKE_CURRENT_SOURCE_DIR}/setup.py.in" "${CMAKE_CURRENT_BINARY_DIR}/setup.py" @ONLY)
   add_custom_target( visp_python_bindings_install
     COMMAND ${CMAKE_COMMAND} -E copy_directory "${CMAKE_CURRENT_SOURCE_DIR}/visp" "${CMAKE_CURRENT_BINARY_DIR}/visp"
+    COMMAND which ${PYTHON3_EXECUTABLE}
+    COMMAND ${PYTHON3_EXECUTABLE} -m pip list
     COMMAND ${PYTHON3_EXECUTABLE} -m pip install  ${_pip_args} "${CMAKE_CURRENT_BINARY_DIR}"
     DEPENDS _visp
   )
diff --git a/modules/python/doc/CMakeLists.txt b/modules/python/doc/CMakeLists.txt
index 8e18226e1..532682b23 100644
--- a/modules/python/doc/CMakeLists.txt
+++ b/modules/python/doc/CMakeLists.txt
@@ -114,7 +114,10 @@ foreach(source_file ${SPHINX_INPUT_SOURCE_FILES})
   list(APPEND generated_deps "${output_file}")
 endforeach()
 
+message("========== Installing visp_python_bindings_doc ==========")
 add_custom_target(visp_python_bindings_doc
+  COMMAND which ${PYTHON3_EXECUTABLE}
+  COMMAND ${PYTHON3_EXECUTABLE} -m pip list
   COMMAND ${PYTHON3_EXECUTABLE} -m pip install -q -r "${CMAKE_CURRENT_SOURCE_DIR}/requirements.txt"
 	COMMAND ${PYTHON3_EXECUTABLE} -m sphinx
 		-b html
diff --git a/modules/python/stubs/CMakeLists.txt b/modules/python/stubs/CMakeLists.txt
index 40e06429b..d8a1b72b7 100644
--- a/modules/python/stubs/CMakeLists.txt
+++ b/modules/python/stubs/CMakeLists.txt
@@ -37,7 +37,19 @@ configure_file("${CMAKE_CURRENT_SOURCE_DIR}/setup.py" "${CMAKE_CURRENT_BINARY_DI
 configure_file("${CMAKE_CURRENT_SOURCE_DIR}/pyproject.toml.in" "${CMAKE_CURRENT_BINARY_DIR}/pyproject.toml" @ONLY)
 
 add_custom_target( visp_python_bindings_stubs
-  COMMAND ${PYTHON3_EXECUTABLE} -m pip install  ${_pip_args} "${CMAKE_CURRENT_BINARY_DIR}"
+COMMAND echo "================  Installing visp_python_bindings_stubs =============="
+COMMAND which ${PYTHON3_EXECUTABLE}
+  COMMAND echo "== cat ${CMAKE_CURRENT_BINARY_DIR}/pyproject.toml file ==="
+  COMMAND cat ${CMAKE_CURRENT_BINARY_DIR}/pyproject.toml
+  COMMAND echo "== EOF ==="
+  COMMAND echo "== cat ${CMAKE_CURRENT_BINARY_DIR}/setup.py file ==="
+  COMMAND cat ${CMAKE_CURRENT_BINARY_DIR}/setup.py
+  COMMAND echo "== EOF ==="
+  COMMAND echo "== python -c import visp ==="
+  COMMAND ${PYTHON3_EXECUTABLE} -vvv -c "import visp"
+  COMMAND echo "== EOF ==="
+  COMMAND ${PYTHON3_EXECUTABLE} -m pip list
+  COMMAND ${PYTHON3_EXECUTABLE} -m pip install -vvv ${_pip_args} "${CMAKE_CURRENT_BINARY_DIR}"
   COMMENT "Generating Python stubs..."
   DEPENDS visp_python_bindings_install
 )
-- 
2.43.0

